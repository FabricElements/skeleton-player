<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../iron-icons/iron-icons.html">
<link rel="import" href="../../iron-icons/av-icons.html">
<link rel="import" href="../../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../paper-progress/paper-progress.html">
<link rel="import" href="../../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../paper-spinner/paper-spinner.html">

<link rel="import" href="../behaviors/skeleton-player-behavior.html">
<link rel="import" href="skeleton-player-slider.html">

<!--
`skeleton-player-controls`
Custom Audio player using material design

@group skeleton-player
@pseudoElement skeleton-player-controls
@demo demo/index.html
-->

<dom-module id="skeleton-player-controls">
  <template>
    <style>
      :host {
        display: block;
        cursor: default;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        background-color: var(--skeleton-player-slider-container-color, var(--paper-grey-100));
      }

      :host[disabled] {
        background-color: var(--skeleton-player-slider-container-color-disabled, var(--paper-grey-500));
      }

      nav {
        display: block;
        @apply(--layout);
        @apply(--layout-justified);
        @apply(--layout-center);
      }

      #actions {
        min-width: 50px;
        height: 50px;
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
        background-color: var(--skeleton-player-action-background, var(--paper-grey-900));
      }

      #actions paper-spinner {
        width: 30px;
        height: 30px;
        margin: 10px;
      }

      paper-icon-button {
        width: 50px;
        height: 50px;
        color: var(--skeleton-player-button-color, #ffffff);
      }

      :host[disabled] paper-icon-button {
        color: var(--skeleton-player-button-color-disabled, #ffffff);
        background-color: var(--skeleton-player-slider-active-color-disabled, var(--paper-grey-500));
      }

      skeleton-player-slider {
        @apply(--layout-flex-auto);
      }

      paper-spinner {
        --paper-spinner-color: var(--player-spinner-color, var(--paper-blue-a100));
      }

      .hidden-true,
      [hidden] {
        display: none;
      }
    </style>
    <template is="dom-if" if="[[controls]]">
      <nav>
        <div id="actions">
          <paper-spinner active$="[[!loaded]]" class$="hidden-[[loaded]]"></paper-spinner>
          <paper-icon-button icon="warning"
                             disabled$="[[disabled]]"
                             class$="hidden-[[!error]]"
          ></paper-icon-button>
          <paper-icon-button icon="block"
                             hidden$="[[!disabled]]"
                             disabled$="[[disabled]]"
                             class$="hidden-[[error]]"
          ></paper-icon-button>
          <paper-icon-button icon="av:replay"
                             on-tap="play"
                             hidden$="[[!ended]]"
                             disabled$="[[disabled]]"
                             class$="hidden-[[disabled]] hidden-[[!loaded]]"
          ></paper-icon-button>
          <paper-icon-button icon="av:play-arrow"
                             on-tap="play"
                             class$="hidden-[[ended]] hidden-[[disabled]] hidden-[[playing]] hidden-[[!loaded]]"
                             disabled$="[[disabled]]"
          ></paper-icon-button>
          <paper-icon-button icon="av:pause"
                             on-tap="pause"
                             disabled$="[[disabled]]"
                             class$="hidden-[[disabled]] hidden-[[paused]] hidden-[[!playing]] hidden-[[!loaded]]"
          ></paper-icon-button>
        </div>
        <skeleton-player-slider value="[[progress]]"
                                secondary-progress="[[secondaryProgress]]"
                                immediate-value="{{immediateValue}}"
                                disabled$="[[disabled]]"
        ></skeleton-player-slider>
      </nav>
    </template>
  </template>

  <script>
    Polymer({

      is: 'skeleton-player-controls',
      properties: {
        progress: {
          type: Number,
          notify: true
        },
        ended: {
          type: Boolean,
          value: false
        },
        playing: {
          type: Boolean,
          value: false
        },
        paused: {
          type: Boolean,
          value: false
        },
        disabled: {
          type: Boolean,
          value: false
        },
        error: {
          type: Boolean,
          value: false
        },
        loaded: {
          type: Boolean,
          value: false
        },
      },
      listeners: {
        "change": "change"
      },
      behaviors: [
//        Fabric.SkeletonPlayerBehavior
      ],
      play: function () {
        this.fire('play');
      },
      pause: function () {
        this.fire('pause');
      },
      change: function () {
        let position = this.immediateValue / 100;
        this.fire('change-progress', position);
      }
    });
  </script>
</dom-module>
